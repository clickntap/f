(function(){f().prototype().fileupload=function(a){a=a||{};this.each(function(d){d.getAttribute("fileupload")||(d.onchange=function(){var e=this,k=e.files,n=e.getAttribute("data-url"),b=void 0;try{b=JSON.parse(e.getAttribute("data-json"))}catch(q){}f().api(function(d){for(var g=0;g<k.length;g++){var l=k[g],c=new XMLHttpRequest,h=new FormData;if(void 0!==b){var p=new Blob([JSON.stringify(b)],{type:"application/json"});h.append("json",p)}h.set(e.name,l,l.name);"undefined"!=typeof a.timeout&&(c.timeout=
            a.timeout);"function"==typeof a.progress&&(c.onprogress=a.progress);c.onloadend=function(m){"function"==typeof a.stop&&setTimeout(function(){a.stop(m)},0);if(void 0!==b){try{b.info=JSON.parse(m.target.responseText)}catch(r){}delete b.progress;f("upload-complete").emit(b)}e.value=""};"function"==typeof a.start&&(c.onloadstart=a.start);c.open("POST",n);f(Object.keys(d)).each(function(b){c.setRequestHeader(b,d[b])});c.upload.addEventListener("progress",function(a){a.lengthComputable&&(a=a.loaded/a.total,
void 0!==b&&(b.progress=a,f("upload-progress").emit(b)))},!1);c.send(h);void 0!==b&&(delete b.progress,f("upload-start").emit(b))}});d.blur()},d.setAttribute("fileupload",!0))})}})();