(function(){function g(a){var b="";a=new Uint8Array(a);for(var c=a.byteLength,d=0;d<c;d++)b+=String.fromCharCode(a[d]);return window.btoa(b)}function h(a){a=window.atob(a);for(var b=a.length,c=new Uint8Array(b),d=0;d<b;d++)c[d]=a.charCodeAt(d);return c}function k(a){for(var b=new Uint8Array(a.length),c=a.length;c--;)b[c]=a.charCodeAt(c);return b.buffer}function l(a){a=new Uint8Array(a);return String.fromCharCode.apply(String,a)}var e={};f().prototype().api=function(a,b){b||(b="web");if("function"==
    typeof a){var c={};if(e.k){var d={t:(new Date).getTime(),token:localStorage.getItem(b)};f(JSON.stringify(d)).apiEncrypt(function(d){c.token=localStorage.getItem(b);c.sign=d;a(c)})}else a(c)}else if(a&&a.uri&&0<a.uri.indexOf("handshake"))0!=a.uri.indexOf("http")&&0!=a.uri.indexOf("/")&&(a.uri="/"+a.uri),crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(function(b){crypto.subtle.exportKey("raw",b.publicKey).then(function(c){f().http({method:"POST",url:a.uri,onsuccess:function(c){var d=
  JSON.parse(c.target.responseText);localStorage.setItem(a.channel,d.d);crypto.subtle.importKey("spki",h(d.k),{name:"ECDH",namedCurve:"P-256"},!0,[]).then(function(c){crypto.subtle.deriveKey({name:"ECDH","public":c},b.privateKey,{name:"AES-CTR",length:256},!1,["encrypt","decrypt"]).then(function(b){e.k=b;e.t=d.t;e.u=d.u;a.onsuccess()})})},params:{k:g(c),t:(new Date).getTime(),d:localStorage.getItem(a.channel),c:a.channel}})})});else return{authenticated:e.u};return this};f().prototype().decodeBase64=
  function(){return l(h(this.input))};f().prototype().encodeBase64=function(){return g(k(this.input))};f().prototype().apiDecrypt=function(a){crypto.subtle.decrypt({name:"AES-CTR",length:128,counter:new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])},e.k,h(this.input)).then(function(b){a(l(b))});return this};f().prototype().apiEncrypt=function(a){crypto.subtle.encrypt({name:"AES-CTR",length:128,counter:new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])},e.k,k(this.input)).then(function(b){a(g(b))});
return this}})();